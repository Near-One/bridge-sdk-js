---
title: UTXO Selection
description: Selecting UTXOs for Bitcoin/Zcash transactions
---

# UTXO Selection

The BTC builder provides utilities for selecting and managing UTXOs.

## selectUtxos

Selects UTXOs to cover a target amount plus fees.

### Signature

```typescript
builder.selectUtxos(
  utxos: NormalizedUTXO[],
  amount: bigint,
  options?: Partial<UtxoSelectionOptions>
): UtxoSelectionResult
```

### Parameters

<ResponseField name="utxos" type="NormalizedUTXO[]" required>
  Available UTXOs to select from.
</ResponseField>

<ResponseField name="amount" type="bigint" required>
  Target amount in satoshis.
</ResponseField>

<ResponseField name="options" type="UtxoSelectionOptions">
  <Expandable title="UtxoSelectionOptions">
    <ResponseField name="feeRate" type="number">
      Fee rate in sat/vbyte. Default: 10
    </ResponseField>
  </Expandable>
</ResponseField>

### Returns

```typescript
interface UtxoSelectionResult {
  inputs: NormalizedUTXO[]
  totalInput: bigint
  fee: bigint
  change: bigint
  outputs: number
}
```

### Example

```typescript
const utxos = [
  { txid: "abc...", vout: 0, balance: 50000n },
  { txid: "def...", vout: 1, balance: 100000n },
]

const selected = btc.selectUtxos(utxos, 75000n, { feeRate: 15 })

console.log(`Using ${selected.inputs.length} inputs`)
console.log(`Total: ${selected.totalInput} satoshis`)
console.log(`Fee: ${selected.fee} satoshis`)
console.log(`Change: ${selected.change} satoshis`)
```

## buildWithdrawalPlan

Builds a complete withdrawal plan with inputs and outputs.

### Signature

```typescript
builder.buildWithdrawalPlan(
  utxos: UTXO[],
  amount: bigint,
  targetAddress: string,
  changeAddress: string,
  feeRate?: number,
  overrides?: UtxoPlanOverrides
): BtcWithdrawalPlan
```

### Returns

```typescript
interface BtcWithdrawalPlan {
  inputs: string[]  // "txid:vout" format
  outputs: Array<{ value: number; script_pubkey: string }>
  fee: bigint
}
```

### Example

```typescript
const plan = btc.buildWithdrawalPlan(
  utxos,
  100000n,  // 0.001 BTC
  "bc1qrecipient...",
  "bc1qchange...",
  15  // sat/vbyte
)

console.log(`Inputs: ${plan.inputs.join(", ")}`)
console.log(`Fee: ${plan.fee} satoshis`)
```

## UTXO Types

```typescript
interface UTXO {
  txid: string
  vout: number
  balance: bigint | number | string
  tx_bytes?: Uint8Array | number[]
  path?: string  // HD derivation path
}

interface NormalizedUTXO {
  txid: string
  vout: number
  balance: bigint
}
```

## Dust Thresholds

Different chains have different dust thresholds:

| Chain | Dust Threshold |
|-------|---------------|
| Bitcoin | 546 satoshis |
| Zcash | 5000 zatoshis |

```typescript
import { ZCASH_DUST_THRESHOLD } from "@omni-bridge/btc"
// 5000n
```

## Related

- [Fee Calculation](/reference/btc/fee-calculation)
- [createBtcBuilder](/reference/btc/create-builder)
- [Bitcoin Transfers Guide](/guides/bitcoin-transfers)
