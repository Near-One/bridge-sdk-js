---
title: Bitcoin Transfers
description: Bridge Bitcoin and Zcash to NEAR
---

# Bitcoin Transfers

This guide covers bridging Bitcoin (and Zcash) to and from NEAR Protocol.

<Note>
  Bitcoin and Zcash use a different flow than other chains. They're UTXO-based, so deposits generate a unique address and withdrawals require MPC signing.
</Note>

## Setup

```typescript
import { createBridge } from "@omni-bridge/core"
import { createBtcBuilder } from "@omni-bridge/btc"
import { createNearBuilder } from "@omni-bridge/near"

const bridge = createBridge({ network: "mainnet" })
const btc = createBtcBuilder({ network: "mainnet", chain: "btc" })
const nearBuilder = createNearBuilder({ network: "mainnet" })
```

For Zcash:

```typescript
const zec = createBtcBuilder({ network: "mainnet", chain: "zcash" })
```

## Deposit Flow: Bitcoin → NEAR

<Steps>
  <Step title="Get a deposit address">
    Generate a unique deposit address for your NEAR recipient:

    ```typescript
    const result = await bridge.getUtxoDepositAddress(
      "btc",
      "alice.near"  // NEAR recipient
    )

    console.log(`Send BTC to: ${result.depositAddress}`)
    console.log(`Minimum: ${result.minDeposit} satoshis`)
    ```

    <Warning>
      Each deposit address is unique to the recipient. Don't reuse addresses for different recipients.
    </Warning>
  </Step>

  <Step title="Send Bitcoin">
    Send Bitcoin to the deposit address using any wallet. Wait for confirmations.

    <Tip>
      Check the minimum deposit amount. Deposits below the minimum will not be processed.
    </Tip>
  </Step>

  <Step title="Finalize on NEAR">
    After the Bitcoin transaction is confirmed, finalize the deposit on NEAR:

    ```typescript
    import { toNearKitTransaction } from "@omni-bridge/near"
    import { Near } from "near-kit"

    const near = new Near({ network: "mainnet", privateKey: "ed25519:..." })

    // Get the deposit proof
    const proof = await btc.getDepositProof(
      "your_btc_tx_hash",
      0  // output index (vout)
    )

    // Build finalization transaction
    const finalizeTx = nearBuilder.buildUtxoDepositFinalization({
      chain: "btc",
      txHash: "your_btc_tx_hash",
      vout: 0,
      proof,
      signerId: "alice.near",
    })

    // Send to NEAR
    await toNearKitTransaction(near, finalizeTx).send()
    ```
  </Step>
</Steps>

### Finding the Output Index (vout)

Check your Bitcoin transaction on a block explorer:
1. Go to [blockstream.info](https://blockstream.info) or [mempool.space](https://mempool.space)
2. Find your transaction
3. Look at the outputs - find the one going to your deposit address
4. The position (0, 1, 2, ...) is your `vout`

## Withdrawal Flow: NEAR → Bitcoin

<Steps>
  <Step title="Initiate withdrawal on NEAR">
    ```typescript
    const withdrawTx = nearBuilder.buildUtxoWithdrawalInit({
      chain: "btc",
      recipient: "bc1qyourbitcoinaddress...",
      amount: 100000n, // satoshis
      signerId: "alice.near",
    })

    const result = await toNearKitTransaction(near, withdrawTx).send()
    ```
  </Step>

  <Step title="Wait for MPC signing">
    The bridge uses MPC (Multi-Party Computation) to sign Bitcoin transactions:

    ```typescript
    // The withdrawal ID comes from the NEAR transaction
    const withdrawalId = extractWithdrawalId(result)

    // Wait for signing (can take a few minutes)
    const signedTx = await nearBuilder.waitForUtxoSigning(
      "btc",
      withdrawalId
    )
    ```
  </Step>

  <Step title="Broadcast to Bitcoin network">
    ```typescript
    const btcTxHash = await btc.broadcastTransaction(signedTx.txHex)
    console.log(`Bitcoin TX: ${btcTxHash}`)
    ```
  </Step>
</Steps>

## Complete Deposit Example

```typescript
import { createBridge } from "@omni-bridge/core"
import { createBtcBuilder } from "@omni-bridge/btc"
import { createNearBuilder, toNearKitTransaction } from "@omni-bridge/near"
import { Near } from "near-kit"

// Setup
const bridge = createBridge({ network: "mainnet" })
const btc = createBtcBuilder({ network: "mainnet", chain: "btc" })
const nearBuilder = createNearBuilder({ network: "mainnet" })
const near = new Near({ network: "mainnet", privateKey: "ed25519:..." })

// Step 1: Get deposit address
const { depositAddress, minDeposit } = await bridge.getUtxoDepositAddress(
  "btc",
  "alice.near"
)
console.log(`Send at least ${minDeposit} satoshis to: ${depositAddress}`)

// Step 2: User sends Bitcoin externally...
const btcTxHash = "abc123..."  // From user's wallet
const vout = 0

// Step 3: Get proof and finalize
const proof = await btc.getDepositProof(btcTxHash, vout)

const finalizeTx = nearBuilder.buildUtxoDepositFinalization({
  chain: "btc",
  txHash: btcTxHash,
  vout,
  proof,
  signerId: "alice.near",
})

const result = await toNearKitTransaction(near, finalizeTx).send()
console.log(`Deposit finalized! nBTC credited to alice.near`)
```

## UTXO Selection

For withdrawals, the bridge automatically selects UTXOs. For advanced use cases:

```typescript
// Get available UTXOs
const utxos = await nearBuilder.getUtxoAvailableOutputs("btc")

// Custom UTXO selection
const selected = btc.selectUtxos(utxos, amount, {
  feeRate: 10,  // sat/vbyte
})

console.log(`Using ${selected.inputs.length} inputs`)
console.log(`Total: ${selected.totalInput} satoshis`)
console.log(`Fee: ${selected.fee} satoshis`)
```

## Fee Calculation

### Bitcoin

Bitcoin uses a linear fee model based on transaction size:

```typescript
import { linearFeeCalculator } from "@omni-bridge/btc"

const calculator = linearFeeCalculator({
  base: 10,    // base tx size
  input: 68,   // size per input
  output: 31,  // size per output
  rate: 15,    // sat/vbyte
})

const fee = calculator(2, 2)  // 2 inputs, 2 outputs
```

### Zcash

Zcash uses ZIP-317 marginal fee calculation:

```typescript
import { zcashFeeCalculator, ZCASH_DUST_THRESHOLD } from "@omni-bridge/btc"

const calculator = zcashFeeCalculator()
const fee = calculator(2, 2)  // 2 inputs, 2 outputs

// Zcash has a higher dust threshold
console.log(`Dust threshold: ${ZCASH_DUST_THRESHOLD}`)  // 5000 zatoshis
```

## Checking Balances

```typescript
// Check nBTC balance on NEAR
const balance = await nearBuilder.getUtxoTokenBalance("btc", "alice.near")
console.log(`nBTC balance: ${balance} satoshis`)

// Check withdrawal fee
const fee = await nearBuilder.calculateUtxoWithdrawalFee("btc", amount)
console.log(`Withdrawal fee: ${fee} satoshis`)
```

## Connector Configuration

```typescript
const config = await nearBuilder.getUtxoConnectorConfig("btc")

console.log({
  minDeposit: config.min_deposit_amount,
  minWithdraw: config.min_withdraw_amount,
  depositFee: config.deposit_bridge_fee,
  withdrawFee: config.withdraw_bridge_fee,
})
```

## Zcash Support

Zcash works identically to Bitcoin, just change the chain parameter:

```typescript
const zec = createBtcBuilder({ network: "mainnet", chain: "zcash" })

// Deposit
const { depositAddress } = await bridge.getUtxoDepositAddress(
  "zcash",
  "alice.near"
)

// Withdrawal
const withdrawTx = nearBuilder.buildUtxoWithdrawalInit({
  chain: "zcash",
  recipient: "t1yourzcashaddress...",
  amount: 100000n,
  signerId: "alice.near",
})
```

<Note>
  Zcash uses transparent addresses (`t1...`). Shielded addresses are not supported.
</Note>

## Error Handling

```typescript
try {
  const proof = await btc.getDepositProof(txHash, vout)
} catch (error) {
  if (error.message.includes("not found")) {
    console.log("Transaction not found or not confirmed")
  } else if (error.message.includes("invalid vout")) {
    console.log("Wrong output index")
  }
}

try {
  await nearBuilder.waitForUtxoSigning("btc", withdrawalId)
} catch (error) {
  if (error.message.includes("timeout")) {
    console.log("MPC signing took too long - try again later")
  }
}
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Tracking Transfers" icon="magnifying-glass" href="/guides/tracking-transfers">
    Monitor transfer status
  </Card>
  <Card title="UTXO Selection" icon="coins" href="/reference/btc/utxo-selection">
    Advanced UTXO handling
  </Card>
  <Card title="Fee Calculation" icon="calculator" href="/reference/btc/fee-calculation">
    Fee estimation APIs
  </Card>
  <Card title="API Reference" icon="code" href="/reference/btc/create-builder">
    Complete BTC builder API
  </Card>
</CardGroup>
